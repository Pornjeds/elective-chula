
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>การลงทะเบียนวิชาเรียน: Y-Ex, MBA</title>

    <!-- Bootstrap core CSS -->
    <link href="../scripts/css/bootstrap.min.css" rel="stylesheet">
    <link href="../scripts/css/jasny-bootstrap.min.css" rel="stylesheet">
    <link href="../scripts/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="../scripts/css/jquery-ui.min.css" rel="stylesheet" >

    <!-- Custom styles for this template -->
    <link href="../scripts/css/admin_template.css" rel="stylesheet">
    
    <style>
        #sortableMain {
            list-style-type: none;
            text-align: center;
            background: #ddd;
            padding: 0px;
            position: relative;
            min-height: 26px;
            vertical-align: top;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        #sortableMain li{
            position: relative;
        }
        
        ul[id*='sortable']:not(#sortableMain) {
            width: 200px;
            min-height: 35px;
            list-style-type: none;
            margin-top: 2px;
            background: #ddd;
            text-align: center;
            margin-left: 1px;
            position: relative;
        }
        
        ul[id*='sortable'] li {
            font-size: 1.2em;
            background-color: #dff0d8;
            border: 1px solid #d6e9c6;
            color: #000;
            width: 200px;
            margin-left: 3px;
            padding: 5px;
            color: green;
            word-wrap: break-word;
        }
        
        li:hover{
            cursor: default;
        }
        
        tr{
            vertical-align: top;
            text-align: center;
        }
        
        .step2div{
            background: #f6f6f6; 
            width: 100%; 
            border: 1px solid #c8c8c8;
            min-width: 900px;
            margin-bottom: 5px;
        }
        
        #step2Area div.btn-group.bootstrap-select{
            width: 133px;
        }
        
    </style>
    
  </head>

  <body>

    <div class="topnavbar">
        <div class="topnavbar-right">
          <ul>
            <li>
              <p class="topnavbar-text"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Logged in as Admin</p>
            </li>
            <li>
              <p class="topnavbar-text"><a href="../index.html">Log out</a></p>
            </li>
          </ul>
        </div>
    </div>

    <div class="navmenu navmenu-default navmenu-fixed-left offcanvas">
      <a class="navmenu-brand" href="#">Y-Ex, MBA</a>
      <ul class="nav navmenu-nav">
        <li><a href='admin_importdata.html'>ระบบ Import ข้อมูล</a></li>
        <li class='active'><a href='#'>การลงทะเบียนวิชาเรียน</a></li>
        <li><a href="admin_displayresult.html">แสดงผลการเลือก</a></li>
      </ul>
      <ul class="nav navmenu-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Advance<b class="caret"></b></a>
          <ul class="dropdown-menu navmenu-nav">
            <li><a href="admin_account.html">จัดการสิทธิ์การเข้าถึงระบบ Admin</a></li>
            <li><a href="admin_dataeditor.html">แก้ไขข้อมูลใน Database</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navmenu-nav">
        <li><a href="../index.html"><font color="red">ออกจากระบบ</font></a></li>
      </uL>
    </div>

    <div class="navbar navbar-default navbar-fixed-top">
      <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".navmenu" data-canvas="body">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>


    <div class="container">

      <ol class="breadcrumb">
        <li><a href="admin_dashboard.html">Home</a></li>
        <li class="active">การลงทะเบียนวิชาเรียน<li>
      </ol>

      <div class="starter-template">
        <h1>การลงทะเบียนวิชาเรียน</h1>
        <p>
          โปรดเลือกรุ่นของนักศึกษาและเทอมที่ต้องการอัพเดทวิชาเลือก
        </p>
      </div>
      <div style='background:#f6f6f6; width: 100%; border: 1px solid #c8c8c8; text-align: center;'>
            <div style='padding:10px;'>
                <div style='padding: 5px 5px 5px 5px; margin-right: 5px; display: inline-block;'>
                    <select id='studentYear' class="selectpicker">
                        <option value="" selected disabled>รุ่นนักศึกษา</option>
                        <option>20/1</option>
                        <option>20/2</option>
                        <option>21/1</option>
                        <option>21/2</option>
                    </select>
                </div> 
                <div style='padding: 5px 5px 5px 5px; margin-right: 5px; display: inline-block;'>
                    <select id='studentSemester' class="selectpicker">
                        <option value="" selected disabled>เทอม</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                    </select>
                </div> 
                <input style='margin-left: 8px;' type='button' class="btn btn-success" onClick='queryFromCriteria();' value='Update' />
            </div>
         </div>
      <hr>
      
      <div id='step1Area' style='line-height: 26px; min-width: 600px; display: none; text-align: center;'>
            <table style='margin-left: auto; margin-right: auto;'>
                <tr>
                    <td><h4>วิชาเลือกทั้งหมด</h4></td>
                    <td style='width: 40px;'></td>
                    <td><h4>วิชาเลือกสำหรับเทอมนี้<span id='countSelected'>(0)</span></h4></td>
                </tr>
                <tr>
                    <td>
                        <ul id="sortableMain" class="connectedSortable">
                        </ul>
                    </td>
                    <td></td>
                    <td>
                        <div id='selectedZone' style='display: inline-block; background: #efefef; display: inline-block; color: #666;'></div>
                    </td>
                </tr>
            </table>
            
            <div style='margin-top: 20px;'>
                <input type='button' class="btn btn-primary" onClick='toggleToSteps(2)' value='Next' />
            </div>
      </div>
        
      <div id='step2Area' style='line-height: 26px; display:none; text-align: center;'>
            <div></div>
            <div style='display: inline-block; background: #efefef; color: #666; margin-top: 20px;'>
                        - หากเราใส่ค่าในช่อง '#สูงสุด' หรือ '#ขั้นต่ำ' จะถูกนำมาใช้เป็นเงื่อนไขในการเปิดสอนรายวิชา
            </div>
            <div style='margin-top: 20px;'>
                <input  type='button' class="btn btn-primary" onClick='toggleToSteps(1)' value='Back' />
                <input style='margin-left: 20px;' type='button' class="btn btn-success" onClick='onSubmitSubject();' value='Submit' />
            </div>
      </div>
      
      <hr>
      <footer class="footer">
          <div style='margin-bottom: 60px'>
            We are the same <span style='color:#cb70d7; font-weight: bold;'>CHULA</span> so let talk together.
          </div>
        </footer>

    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../scripts/js/jquery.min.js"></script>
    <script src="../scripts/js/jquery-ui.min.js"></script>
    <script src="../scripts/js/bootstrap.min.js"></script>
    <script src="../scripts/js/jasny-bootstrap.min.js"></script>    
    <script src="../scripts/js/bootstrap-select.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../scripts/js/ie10-viewport-bug-workaround.js"></script>

    <script>
        $(document).ready(function () {
            //ACTIVATE DDL
            $('.selectpicker').selectpicker();
        });
        //
        //WHEN SELECT CLASS FROM CRITERIA
        function queryFromCriteria(){
            if( $('#studentYear').val() === null || $('#studentSemester').val() === null ){
                alert('Please select criteria first');
            }
            else{
                $('#sortableMain').empty();
                $('#selectedZone').empty();
                var mocTotalSubject = ['INTER FINANCIAL', 'ENTREPRENEUR', 'ORGANIZATION BEHAVIOUR', 'OPERATION MANAGEMENT', 'MARKETING MANAGEMENT', 'FINANCIAL MANAGEMENT', 'FOUNDAMENTAL ACCOUNTING', 'DECISION MAKING', 'ECON BUS MANAGEMENT', 'MANAGEMENT ACCOUNT', 'STAT BUS ADMIN' ]
                for(var i =0; i < mocTotalSubject.length; i++){
                    var tmpLiElement = document.createElement('li');
                    tmpLiElement.innerHTML = mocTotalSubject[ i ];
                    $('#sortableMain').append( tmpLiElement );
                }
                //
                //ADD <UL> LANDING ITEMS
                var selectedZoneElement = document.getElementById('selectedZone');
                var initialNum = 5;
                for( var i=0; i< initialNum; i++){
                    var tmpUIElement =  document.createElement('ul');
                    tmpUIElement.id = 'sortable' + i;
                    tmpUIElement.className = 'connectedSortable';
                    tmpUIElement.style.padding = '0px';
                    tmpUIElement.style.marginBottom = '0px';
                    selectedZoneElement.appendChild( tmpUIElement );
                }
                
                //BIND DRAG/SORABLE EVENT
                $( '.connectedSortable' ).sortable({
                    connectWith: ".connectedSortable",
                    stop: function( event, ui) {
                        var sortableElements = $('.connectedSortable');
                        for(var i=0; i< sortableElements.length; i++){
                            if( sortableElements[ i ].id !== 'sortableMain' && sortableElements[ i ].children.length > 1 ){
                                $(this).sortable( 'cancel');
                            }
                        }
                        var countSelectedItem = countSelectedItemText();
                        if( $('#selectedZone').children().length <= countSelectedItem ){
                            var tmpUIElement =  document.createElement('ul');
                            tmpUIElement.id = 'sortable' + (countSelectedItem+1) ;
                            tmpUIElement.className = 'connectedSortable';
                            tmpUIElement.style.padding = '0px';
                            tmpUIElement.style.marginBottom = '0px';
                            $('#selectedZone').append( tmpUIElement );
                            //ACTIVATE FOR NEW ITEM ADDED
                            $( '.connectedSortable' ).sortable({
                                connectWith: ".connectedSortable"
                            }).disableSelection();
                        }
                    },
                    receive: function(){
                        countSelectedItemText();
                    }
                }).disableSelection();
                //
                $('#step1Area').fadeIn(300);
            }
        }
        //COUNT <LI> FOR MANAGE ADDTIONAL <UL> LANDING ITEMS
        function countSelectedItemText(){
            var countSelectedItem = 0;
            $('#selectedZone').children().each(function(){
                if( $(this).children().length > 0 ){
                    countSelectedItem++;
                }
            });
            //UPDATE NUMBER OF SELECTION
            $('#countSelected').text( '(' + countSelectedItem +')' );
            return countSelectedItem;
        }
        
        //SWITCHER BETWEEN 1/2
        function toggleToSteps( value ){
            if( value === 1 ){
                //REMOVE CURRENT EXISTING ITEMS
                $('#step2Area').children().first().empty();
                //
                $('#step1Area').fadeIn(300);
                $('#step2Area').fadeOut(10);
            }
            else if( value === 2 ){
                if( countSelectedItemText() === 0 ){
                    alert( 'Please select subjects first.' );
                    return;
                }
                var index = 0;
                //GENERATE ITEMS FOLLOW STEP-1
                $('#selectedZone').children().each(function(){
                    if( $(this).children().length > 0 ){
                        var itemDiv = document.createElement('div');
                        itemDiv.id = 'item' + index;
                        itemDiv.className = 'step2div';
                        $('#step2Area').children().first().append( itemDiv );
                        //TEXT SUBJECT
                        var itemDivTextSubject = document.createElement('div');
                        itemDivTextSubject.id = 'item' + index + '_subject';
                        itemDivTextSubject.style.display = 'inline-block';
                        itemDivTextSubject.style.marginRight = '10px';
                        itemDivTextSubject.style.width = '200px';
                        itemDivTextSubject.style.wordWrap = 'break-word';
                        itemDivTextSubject.style.verticalAlign = 'middle';
                        itemDivTextSubject.innerHTML = $(this).children().text();
                        itemDiv.appendChild( itemDivTextSubject )
                        //DDL DATE
                        var itemDivSubject = document.createElement('div');
                        itemDivSubject.style.display = 'inline-block';
                        itemDiv.appendChild( itemDivSubject );
                        var itemDivSubjectSelect = document.createElement('select');
                        itemDivSubjectSelect.className = 'selectpicker';
                        itemDivSubjectSelect.id = 'item' + index + '_date';
                        itemDivSubject.appendChild( itemDivSubjectSelect );
                        //
                        var days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                        var tmpPlaceHolder = document.createElement('option');
                        tmpPlaceHolder.setAttribute('value', 'N/A');
                        tmpPlaceHolder.setAttribute('selected','true');
                        tmpPlaceHolder.setAttribute('disabled','true');
                        tmpPlaceHolder.innerHTML = 'วันที่สอน';
                        itemDivSubjectSelect.appendChild( tmpPlaceHolder );
                        for(var i=0; i < days.length; i++){
                            var tmpOption = document.createElement('option');
                            tmpOption.setAttribute('value', i );
                            tmpOption.innerHTML = days[i];
                            itemDivSubjectSelect.appendChild( tmpOption );
                        }
                        //TEXT TEACHER
                        var itemDivTeacher = document.createElement('div');
                        itemDivTeacher.style.display = 'inline-block';
                        itemDivTeacher.style.marginRight = '10px';
                        itemDivTeacher.style.marginLeft = '20px';
                        itemDiv.appendChild( itemDivTeacher );
                        //
                        var itemDivTeacherInput = document.createElement('input');
                        itemDivTeacherInput.className = 'form-control';
                        itemDivTeacherInput.id = 'item' + index + '_teacher';
                        itemDivTeacherInput.style.paddingTop = '4px';
                        itemDivTeacherInput.setAttribute('type', 'text');
                        itemDivTeacherInput.setAttribute('placeholder', 'ชื่ออาจารย์ผู้สอน');
                        itemDivTeacher.appendChild( itemDivTeacherInput );
                        //TEXT NUMBER SUPPORT
                        var itemDivNumberSupport = document.createElement('div');
                        itemDivNumberSupport.style.display = 'inline-block';
                        itemDivNumberSupport.style.marginRight = '10px';
                        itemDivNumberSupport.style.width = '70px';
                        itemDiv.appendChild( itemDivNumberSupport );
                        //
                        var itemDivNumberSupportInput = document.createElement('input');
                        itemDivNumberSupportInput.className = 'form-control';
                        itemDivNumberSupportInput.id = 'item' + index + '_numberSupport';
                        itemDivNumberSupportInput.style.paddingTop = '4px';
                        itemDivNumberSupportInput.setAttribute('type', 'text');
                        itemDivNumberSupportInput.setAttribute('placeholder', '#สูงสุด');
                        itemDivNumberSupport.appendChild( itemDivNumberSupportInput );
                        //TEXT MINIMUM NUMBER TO OPEN
                        var itemDivMinNumber = document.createElement('div');
                        itemDivMinNumber.style.display = 'inline-block';
                        itemDivMinNumber.style.margin = '5px 10px 5px 0px';
                        itemDivMinNumber.style.width = '70px';
                        itemDiv.appendChild( itemDivMinNumber );
                        //
                        var itemDivMinNumberInput = document.createElement('input');
                        itemDivMinNumberInput.className = 'form-control';
                        itemDivMinNumberInput.id = 'item' + index + '_minNumber';
                        itemDivMinNumberInput.style.paddingTop = '4px';
                        itemDivMinNumberInput.setAttribute('type', 'text');
                        itemDivMinNumberInput.setAttribute('placeholder', '#ขั้นต่ำ');
                        itemDivMinNumber.appendChild( itemDivMinNumberInput );
                        //DDL METHOD
                        var itemDivMethod = document.createElement('div');
                        itemDivMethod.style.display = 'inline-block';
                        itemDiv.appendChild( itemDivMethod );
                        var itemDivMethodSelect = document.createElement('select');
                        itemDivMethodSelect.className = 'selectpicker';
                        itemDivMethodSelect.id = 'item' + index + '_method';
                        itemDivMethod.appendChild( itemDivMethodSelect );
                        //
                        var methods = ['First Come First Serve', 'Sorting by GPA', 'Random out by rank'];
                        var tmpPlaceHolderMethod = document.createElement('option');
                        tmpPlaceHolderMethod.setAttribute('value', 'N/A');
                        tmpPlaceHolderMethod.setAttribute('selected','true');
                        tmpPlaceHolderMethod.setAttribute('disabled','true');
                        tmpPlaceHolderMethod.innerHTML = 'วิธีที่ใช้ตัดสินกรณีไม่ลงตัว';
                        itemDivMethodSelect.appendChild( tmpPlaceHolderMethod );
                        for(var i=0; i < methods.length; i++){
                            var tmpOptionMethod = document.createElement('option');
                            tmpOptionMethod.setAttribute('value', i );
                            tmpOptionMethod.innerHTML = methods[i];
                            itemDivMethodSelect.appendChild( tmpOptionMethod );
                        }
                        //
                        index++;
                    }
                });
                $('.selectpicker').selectpicker();
                //
                $('#step1Area').fadeOut(10);
                $('#step2Area').fadeIn(300);
            }
        }
    
        //WHEN SUBMIT
        function onSubmitSubject(){
            var result = '';
            $('#step2Area').children().first().children().each( function(index){
                var idTextSubject = '#item' + index + '_subject';
                var idDate = '#item' + index + '_date';
                var idTeacher = '#item' + index + '_teacher';
                var idNumSupport = '#item' + index + '_numberSupport';
                var idNumMin = '#item' + index + '_minNumber';
                var idMethod = '#item' + index + '_method';
                
                result += $(idTextSubject).text() + ',' + $(idDate).val() + ',' + $(idTeacher).val() + ',' + $(idNumSupport).val() + ',' + $(idNumMin).val() + ',' + $(idMethod).val() + '\n';
            });
            alert( result);
        }
        
    </script>
  
    </body>
</html>
